<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:pages="clr-namespace:AquaPP.ViewModels.Pages"
             xmlns:i="https://github.com/projektanker/icons.avalonia"
             xmlns:suki="https://github.com/kikipoulet/SukiUI"
             mc:Ignorable="d" d:DesignWidth="1200" d:DesignHeight="800"
             x:Class="AquaPP.Views.Pages.SensorDetailView"
             x:DataType="pages:SensorDetailViewModel">
    
    <Design.DataContext>
        <pages:SensorDetailViewModel />
    </Design.DataContext>

    <ScrollViewer>
        <Grid RowDefinitions="Auto,Auto,Auto,Auto,*,Auto" Margin="20" RowSpacing="20">
            
            <!-- Header -->
            <suki:GlassCard Grid.Row="0">
                <Grid ColumnDefinitions="*,Auto" Height="60">
                    <StackPanel Grid.Column="0" VerticalAlignment="Center" Spacing="4">
                        <TextBlock Text="{Binding Sensor.Name, FallbackValue='Sensor Detail'}" 
                                   FontSize="24" 
                                   FontWeight="Bold"
                                   Foreground="{DynamicResource SukiText}" />
                        <TextBlock Text="Real-time sensor monitoring and analytics" 
                                   FontSize="13"
                                   Foreground="{DynamicResource SukiLowText}" />
                    </StackPanel>
                    
                    <StackPanel Grid.Column="1" 
                                Orientation="Horizontal" 
                                Spacing="12"
                                VerticalAlignment="Center">
                        <Button Classes="Flat" Command="{Binding RefreshCommand}">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <i:Icon Value="fa-solid fa-arrows-rotate" FontSize="14" />
                                <TextBlock Text="Refresh" />
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </Grid>
            </suki:GlassCard>

            <!-- Sensor Metadata Section -->
            <suki:GlassCard Grid.Row="1">
                <Grid ColumnDefinitions="*,*,*,*,Auto" ColumnSpacing="20">
                    <!-- Sensor Name -->
                    <StackPanel Grid.Column="0" Spacing="6">
                        <TextBlock Text="Sensor Name" 
                                   FontSize="11"
                                   Foreground="{DynamicResource SukiLowText}" />
                        <TextBlock Text="{Binding Sensor.Name, FallbackValue='N/A'}" 
                                   FontSize="14"
                                   FontWeight="SemiBold" />
                    </StackPanel>
                    
                    <!-- Sensor Type -->
                    <StackPanel Grid.Column="1" Spacing="6">
                        <TextBlock Text="Type" 
                                   FontSize="11"
                                   Foreground="{DynamicResource SukiLowText}" />
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <i:Icon Value="fa-solid fa-microchip" 
                                    FontSize="14"
                                    Foreground="{DynamicResource SukiPrimaryColor}"
                                    VerticalAlignment="Center" />
                            <TextBlock Text="{Binding Sensor.Type, FallbackValue='N/A'}" 
                                       FontSize="14"
                                       FontWeight="SemiBold"
                                       VerticalAlignment="Center" />
                        </StackPanel>
                    </StackPanel>
                    
                    <!-- Unit -->
                    <StackPanel Grid.Column="2" Spacing="6">
                        <TextBlock Text="Unit" 
                                   FontSize="11"
                                   Foreground="{DynamicResource SukiLowText}" />
                        <TextBlock Text="{Binding Sensor.Unit, FallbackValue='N/A'}" 
                                   FontSize="14"
                                   FontWeight="SemiBold" />
                    </StackPanel>
                    
                    <!-- Asset -->
                    <StackPanel Grid.Column="3" Spacing="6">
                        <TextBlock Text="Asset" 
                                   FontSize="11"
                                   Foreground="{DynamicResource SukiLowText}" />
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <i:Icon Value="fa-solid fa-industry" 
                                    FontSize="14"
                                    Foreground="{DynamicResource SukiPrimaryColor}"
                                    VerticalAlignment="Center" />
                            <TextBlock Text="{Binding Sensor.Asset.Name, FallbackValue='N/A'}" 
                                       FontSize="14"
                                       FontWeight="SemiBold"
                                       VerticalAlignment="Center" />
                        </StackPanel>
                    </StackPanel>
                    
                    <!-- Status Badge -->
                    <Border Grid.Column="4"
                            Background="{Binding StatusColor}"
                            CornerRadius="12"
                            Padding="12,6"
                            VerticalAlignment="Center">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <i:Icon Value="fa-solid fa-circle" 
                                    FontSize="10"
                                    Foreground="White"
                                    VerticalAlignment="Center" />
                            <TextBlock Text="{Binding StatusText}" 
                                       FontSize="12"
                                       Foreground="White"
                                       FontWeight="SemiBold"
                                       VerticalAlignment="Center" />
                        </StackPanel>
                    </Border>
                </Grid>
            </suki:GlassCard>

            <!-- Current Value Display with Gauge -->
            <suki:GlassCard Grid.Row="2">
                <StackPanel Spacing="16" HorizontalAlignment="Center">
                    <TextBlock Text="Current Value" 
                               FontSize="14"
                               Foreground="{DynamicResource SukiLowText}"
                               HorizontalAlignment="Center" />
                    
                    <StackPanel Orientation="Horizontal" 
                                Spacing="8" 
                                HorizontalAlignment="Center">
                        <TextBlock Text="{Binding CurrentValue, StringFormat='{}{0:F2}'}" 
                                   FontSize="48"
                                   FontWeight="Bold"
                                   VerticalAlignment="Center" />
                        <TextBlock Text="{Binding Sensor.Unit}" 
                                   FontSize="24"
                                   Foreground="{DynamicResource SukiLowText}"
                                   VerticalAlignment="Bottom"
                                   Margin="0,0,0,8" />
                    </StackPanel>
                    
                    <!-- Gauge Progress Bar -->
                    <ProgressBar Value="{Binding CurrentValuePercent}" 
                                 Minimum="0"
                                 Maximum="100"
                                 Height="20"
                                 Width="400"
                                 CornerRadius="10"
                                 Foreground="{Binding StatusColor}"
                                 Background="{DynamicResource SukiCardBackground}" />
                    
                    <!-- Threshold Indicators -->
                    <Grid ColumnDefinitions="*,*" 
                          ColumnSpacing="40"
                          Width="400">
                        <StackPanel Grid.Column="0" Spacing="4">
                            <TextBlock Text="Low Threshold" 
                                       FontSize="10"
                                       Foreground="{DynamicResource SukiLowText}"
                                       HorizontalAlignment="Left" />
                            <TextBlock Text="{Binding Sensor.ThresholdLow, StringFormat='{}{0:F2}', FallbackValue='Not Set'}" 
                                       FontSize="12"
                                       FontWeight="SemiBold"
                                       HorizontalAlignment="Left" />
                        </StackPanel>
                        <StackPanel Grid.Column="1" Spacing="4">
                            <TextBlock Text="High Threshold" 
                                       FontSize="10"
                                       Foreground="{DynamicResource SukiLowText}"
                                       HorizontalAlignment="Right" />
                            <TextBlock Text="{Binding Sensor.ThresholdHigh, StringFormat='{}{0:F2}', FallbackValue='Not Set'}" 
                                       FontSize="12"
                                       FontWeight="SemiBold"
                                       HorizontalAlignment="Right" />
                        </StackPanel>
                    </Grid>
                </StackPanel>
            </suki:GlassCard>

            <!-- Statistics Row -->
            <Grid Grid.Row="3" ColumnDefinitions="*,*,*,*" ColumnSpacing="16">
                <!-- Min Value -->
                <suki:GlassCard Grid.Column="0">
                    <StackPanel Spacing="12">
                        <StackPanel Orientation="Horizontal" Spacing="10">
                            <Border Background="#2196F3"
                                    CornerRadius="8"
                                    Width="36"
                                    Height="36"
                                    VerticalAlignment="Center">
                                <i:Icon Value="fa-solid fa-arrow-down" 
                                        FontSize="16"
                                        Foreground="White"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center" />
                            </Border>
                            <StackPanel Spacing="4">
                                <TextBlock Text="Minimum" 
                                           FontSize="11"
                                           Foreground="{DynamicResource SukiLowText}" />
                                <StackPanel Orientation="Horizontal" Spacing="4">
                                    <TextBlock Text="{Binding MinValue, StringFormat='{}{0:F2}'}" 
                                               FontSize="18"
                                               FontWeight="Bold" />
                                    <TextBlock Text="{Binding Sensor.Unit}" 
                                               FontSize="11"
                                               Foreground="{DynamicResource SukiLowText}"
                                               VerticalAlignment="Bottom"
                                               Margin="0,0,0,2" />
                                </StackPanel>
                            </StackPanel>
                        </StackPanel>
                    </StackPanel>
                </suki:GlassCard>

                <!-- Max Value -->
                <suki:GlassCard Grid.Column="1">
                    <StackPanel Spacing="12">
                        <StackPanel Orientation="Horizontal" Spacing="10">
                            <Border Background="#F44336"
                                    CornerRadius="8"
                                    Width="36"
                                    Height="36"
                                    VerticalAlignment="Center">
                                <i:Icon Value="fa-solid fa-arrow-up" 
                                        FontSize="16"
                                        Foreground="White"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center" />
                            </Border>
                            <StackPanel Spacing="4">
                                <TextBlock Text="Maximum" 
                                           FontSize="11"
                                           Foreground="{DynamicResource SukiLowText}" />
                                <StackPanel Orientation="Horizontal" Spacing="4">
                                    <TextBlock Text="{Binding MaxValue, StringFormat='{}{0:F2}'}" 
                                               FontSize="18"
                                               FontWeight="Bold" />
                                    <TextBlock Text="{Binding Sensor.Unit}" 
                                               FontSize="11"
                                               Foreground="{DynamicResource SukiLowText}"
                                               VerticalAlignment="Bottom"
                                               Margin="0,0,0,2" />
                                </StackPanel>
                            </StackPanel>
                        </StackPanel>
                    </StackPanel>
                </suki:GlassCard>

                <!-- Average Value -->
                <suki:GlassCard Grid.Column="2">
                    <StackPanel Spacing="12">
                        <StackPanel Orientation="Horizontal" Spacing="10">
                            <Border Background="#4CAF50"
                                    CornerRadius="8"
                                    Width="36"
                                    Height="36"
                                    VerticalAlignment="Center">
                                <i:Icon Value="fa-solid fa-chart-line" 
                                        FontSize="16"
                                        Foreground="White"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center" />
                            </Border>
                            <StackPanel Spacing="4">
                                <TextBlock Text="Average" 
                                           FontSize="11"
                                           Foreground="{DynamicResource SukiLowText}" />
                                <StackPanel Orientation="Horizontal" Spacing="4">
                                    <TextBlock Text="{Binding AvgValue, StringFormat='{}{0:F2}'}" 
                                               FontSize="18"
                                               FontWeight="Bold" />
                                    <TextBlock Text="{Binding Sensor.Unit}" 
                                               FontSize="11"
                                               Foreground="{DynamicResource SukiLowText}"
                                               VerticalAlignment="Bottom"
                                               Margin="0,0,0,2" />
                                </StackPanel>
                            </StackPanel>
                        </StackPanel>
                    </StackPanel>
                </suki:GlassCard>

                <!-- Last Update -->
                <suki:GlassCard Grid.Column="3">
                    <StackPanel Spacing="12">
                        <StackPanel Orientation="Horizontal" Spacing="10">
                            <Border Background="#FF9800"
                                    CornerRadius="8"
                                    Width="36"
                                    Height="36"
                                    VerticalAlignment="Center">
                                <i:Icon Value="fa-solid fa-clock" 
                                        FontSize="16"
                                        Foreground="White"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center" />
                            </Border>
                            <StackPanel Spacing="4">
                                <TextBlock Text="Last Update" 
                                           FontSize="11"
                                           Foreground="{DynamicResource SukiLowText}" />
                                <TextBlock Text="{Binding LastUpdate, StringFormat='{}{0:HH:mm:ss}', FallbackValue='N/A'}" 
                                           FontSize="18"
                                           FontWeight="Bold" />
                            </StackPanel>
                        </StackPanel>
                    </StackPanel>
                </suki:GlassCard>
            </Grid>

            <!-- Chart Container Section -->
            <suki:GlassCard Grid.Row="4">
                <StackPanel Spacing="16">
                    <!-- Chart Header with Time Window Selector -->
                    <Grid ColumnDefinitions="*,Auto">
                        <StackPanel Grid.Column="0" Spacing="4">
                            <TextBlock Text="Historical Data" 
                                       FontSize="16"
                                       FontWeight="SemiBold" />
                            <TextBlock Text="Real-time sensor readings over time" 
                                       FontSize="12"
                                       Foreground="{DynamicResource SukiLowText}" />
                        </StackPanel>
                        
                        <StackPanel Grid.Column="1" 
                                    Orientation="Horizontal" 
                                    Spacing="12"
                                    VerticalAlignment="Center">
                            <TextBlock Text="Time Window:" 
                                       FontSize="13"
                                       VerticalAlignment="Center"
                                       Foreground="{DynamicResource SukiLowText}" />
                            <ComboBox ItemsSource="{Binding TimeWindows}"
                                      SelectedItem="{Binding SelectedTimeWindow}"
                                      Width="140">
                                <ComboBox.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Label}" />
                                    </DataTemplate>
                                </ComboBox.ItemTemplate>
                            </ComboBox>
                        </StackPanel>
                    </Grid>
                    
                    <Separator />
                    
                    <!-- Chart Placeholder -->
                    <Border Background="{DynamicResource SukiCardBackground}"
                            BorderBrush="{DynamicResource SukiBorderBrush}"
                            BorderThickness="1"
                            CornerRadius="8"
                            Height="400"
                            Padding="20">
                        <StackPanel HorizontalAlignment="Center" 
                                    VerticalAlignment="Center"
                                    Spacing="16">
                            <i:Icon Value="fa-solid fa-chart-area" 
                                    FontSize="64"
                                    Foreground="{DynamicResource SukiLowText}"
                                    HorizontalAlignment="Center" />
                            <TextBlock Text="Chart Visualization" 
                                       FontSize="18"
                                       FontWeight="SemiBold"
                                       HorizontalAlignment="Center"
                                       Foreground="{DynamicResource SukiText}" />
                            <TextBlock Text="ScottPlot integration will be added in Phase 2" 
                                       FontSize="13"
                                       HorizontalAlignment="Center"
                                       Foreground="{DynamicResource SukiLowText}" />
                            <TextBlock Text="{Binding SelectedTimeWindow.Label, StringFormat='Time Window: {0}'}" 
                                       FontSize="12"
                                       HorizontalAlignment="Center"
                                       Foreground="{DynamicResource SukiPrimaryColor}" />
                        </StackPanel>
                    </Border>
                    
                    <!-- Chart Control Buttons -->
                    <Grid ColumnDefinitions="*,Auto">
                        <StackPanel Grid.Column="0" 
                                    Orientation="Horizontal" 
                                    Spacing="8">
                            <Button Classes="Flat" 
                                    Command="{Binding ZoomInCommand}"
                                    ToolTip.Tip="Zoom In">
                                <StackPanel Orientation="Horizontal" Spacing="6">
                                    <i:Icon Value="fa-solid fa-magnifying-glass-plus" FontSize="14" />
                                    <TextBlock Text="Zoom In" />
                                </StackPanel>
                            </Button>
                            
                            <Button Classes="Flat" 
                                    Command="{Binding ZoomOutCommand}"
                                    ToolTip.Tip="Zoom Out">
                                <StackPanel Orientation="Horizontal" Spacing="6">
                                    <i:Icon Value="fa-solid fa-magnifying-glass-minus" FontSize="14" />
                                    <TextBlock Text="Zoom Out" />
                                </StackPanel>
                            </Button>
                            
                            <Button Classes="Flat" 
                                    Command="{Binding ResetZoomCommand}"
                                    ToolTip.Tip="Reset Zoom">
                                <StackPanel Orientation="Horizontal" Spacing="6">
                                    <i:Icon Value="fa-solid fa-expand" FontSize="14" />
                                    <TextBlock Text="Reset" />
                                </StackPanel>
                            </Button>
                        </StackPanel>
                        
                        <Button Grid.Column="1" 
                                Classes="Accent"
                                Command="{Binding ExportChartCommand}"
                                ToolTip.Tip="Export Chart Data">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <i:Icon Value="fa-solid fa-download" FontSize="14" />
                                <TextBlock Text="Export" />
                            </StackPanel>
                        </Button>
                    </Grid>
                </StackPanel>
            </suki:GlassCard>
            
            <!-- Sensor Readings DataGrid -->
            <suki:GlassCard Grid.Row="5">
                <StackPanel Spacing="16">
                    <TextBlock Text="Sensor Readings"
                               FontSize="16"
                               FontWeight="SemiBold" />

                    <DataGrid ItemsSource="{Binding SensorReadings}"
                              AutoGenerateColumns="False"
                              IsReadOnly="True"
                              Classes="custom-datagrid">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Timestamp"
                                               Binding="{Binding Timestamp, StringFormat='{}{0:MMM dd, HH:mm:ss}'}"
                                               Width="*" />
                            <DataGridTextColumn Header="Value"
                                               Binding="{Binding Value, StringFormat='{}{0:F2}'}"
                                               Width="150" />
                        </DataGrid.Columns>
                    </DataGrid>
                </StackPanel>
            </suki:GlassCard>
        </Grid>
    </ScrollViewer>
    
</UserControl>
