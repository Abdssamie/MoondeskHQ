<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:pages="using:AquaPP.ViewModels.Pages"
             xmlns:iot="using:AquaPP.Core.Models.IoT"
             xmlns:i="clr-namespace:Projektanker.Icons.Avalonia;assembly=Projektanker.Icons.Avalonia"
             mc:Ignorable="d" d:DesignWidth="1200" d:DesignHeight="800"
             x:Class="AquaPP.Views.Pages.AssetDirectoryView"
             x:DataType="pages:AssetDirectoryViewModel">

    <Design.DataContext>
        <pages:AssetDirectoryViewModel />
    </Design.DataContext>

    <Grid RowDefinitions="Auto,*,Auto" Margin="20">
        
        <!-- Header Section -->
        <StackPanel Grid.Row="0" Spacing="10" Margin="0,0,0,20">
            <TextBlock Text="Industrial Asset Directory" 
                       FontSize="28" 
                       FontWeight="Bold" />
            
            <TextBlock Text="Monitor and manage all connected industrial assets and sensors" 
                       FontSize="14" 
                       Opacity="0.7" />
            
            <!-- Action Buttons -->
            <StackPanel Orientation="Horizontal" Spacing="10" Margin="0,10,0,0">
                <Button Command="{Binding LoadAssetsCommand}"
                        IsEnabled="{Binding !IsLoading}">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <i:Icon Value="fa-solid fa-rotate" />
                        <TextBlock Text="Refresh Assets" />
                    </StackPanel>
                </Button>

                <Button Command="{Binding StartStreamingCommand}"
                        IsEnabled="{Binding !IsStreaming}"
                        Classes="Accent">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <i:Icon Value="fa-solid fa-play" />
                        <TextBlock Text="Start Streaming" />
                    </StackPanel>
                </Button>

                <Button Command="{Binding StopStreamingCommand}"
                        IsEnabled="{Binding IsStreaming}">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <i:Icon Value="fa-solid fa-stop" />
                        <TextBlock Text="Stop Streaming" />
                    </StackPanel>
                </Button>
            </StackPanel>

            <!-- Status Bar -->
            <Border Background="{DynamicResource SukiCardBackground}"
                    CornerRadius="8"
                    Padding="12,8">
                <StackPanel Orientation="Horizontal" Spacing="15">
                    <StackPanel Orientation="Horizontal" Spacing="5">
                        <i:Icon Value="fa-solid fa-circle-info" FontSize="16" />
                        <TextBlock Text="{Binding StatusMessage}" FontWeight="Medium" />
                    </StackPanel>
                    
                    <Border Width="1" Background="{DynamicResource SukiLowText}" />
                    
                    <StackPanel Orientation="Horizontal" Spacing="5">
                        <i:Icon Value="fa-solid fa-database" FontSize="16" />
                        <TextBlock>
                            <Run Text="Assets: " />
                            <Run Text="{Binding Assets.Count}" FontWeight="Bold" />
                        </TextBlock>
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" Spacing="5" IsVisible="{Binding IsStreaming}">
                        <i:Icon Value="fa-solid fa-signal" FontSize="16" Foreground="#4CAF50" />
                        <TextBlock Text="Live Streaming" Foreground="#4CAF50" FontWeight="Medium" />
                    </StackPanel>
                </StackPanel>
            </Border>
        </StackPanel>

        <!-- Assets DataGrid -->
        <Border Grid.Row="1" 
                Background="{DynamicResource SukiCardBackground}"
                CornerRadius="12"
                Padding="0">
            
            <DataGrid ItemsSource="{Binding Assets}"
                      SelectedItem="{Binding SelectedAsset}"
                      IsReadOnly="True"
                      AutoGenerateColumns="False"
                      Classes="custom-datagrid">
                
                <DataGrid.Columns>
                    
                    <!-- Status Indicator -->
                    <DataGridTemplateColumn Header="Status" Width="80">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate DataType="iot:Asset">
                                <StackPanel Orientation="Horizontal" 
                                          Spacing="8" 
                                          HorizontalAlignment="Center"
                                          VerticalAlignment="Center">
                                    <Ellipse Width="12" 
                                           Height="12" 
                                           Fill="{Binding Status, Converter={StaticResource StatusColorConverter}}" />
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <!-- Asset Name -->
                    <DataGridTextColumn Header="Asset Name" 
                                       Binding="{Binding Name}" 
                                       Width="*" 
                                       MinWidth="200" />

                    <!-- Type -->
                    <DataGridTextColumn Header="Type" 
                                       Binding="{Binding Type}" 
                                       Width="150" />

                    <!-- Location -->
                    <DataGridTextColumn Header="Location" 
                                       Binding="{Binding Location}" 
                                       Width="200" />

                    <!-- Status Text -->
                    <DataGridTextColumn Header="Status" 
                                       Binding="{Binding Status}" 
                                       Width="120" />

                    <!-- Sensor Count -->
                    <DataGridTemplateColumn Header="Sensors" Width="100">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate DataType="iot:Asset">
                                <StackPanel Orientation="Horizontal" 
                                          Spacing="5"
                                          HorizontalAlignment="Center">
                                    <i:Icon Value="fa-solid fa-gauge" FontSize="14" />
                                    <TextBlock Text="{Binding Sensors.Count}" 
                                             FontWeight="Medium" />
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <!-- Last Seen -->
                    <DataGridTemplateColumn Header="Last Seen" Width="180">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate DataType="iot:Asset">
                                <TextBlock Text="{Binding LastSeen, StringFormat='{}{0:MMM dd, HH:mm:ss}'}" 
                                         HorizontalAlignment="Center" />
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <!-- Manufacturer -->
                    <DataGridTextColumn Header="Manufacturer" 
                                       Binding="{Binding Manufacturer}" 
                                       Width="150" />

                </DataGrid.Columns>
            </DataGrid>
        </Border>

        <!-- Selected Asset Details -->
        <Border Grid.Row="2" 
                Margin="0,20,0,0"
                Background="{DynamicResource SukiCardBackground}"
                CornerRadius="12"
                Padding="20"
                IsVisible="{Binding SelectedAsset, Converter={x:Static ObjectConverters.IsNotNull}}">
            
            <StackPanel Spacing="10">
                <TextBlock Text="Selected Asset Details" 
                          FontSize="18" 
                          FontWeight="Bold" />
                
                <Grid ColumnDefinitions="Auto,*,Auto,*" RowDefinitions="Auto,Auto,Auto" ColumnSpacing="20" RowSpacing="8">
                    <TextBlock Grid.Row="0" Grid.Column="0" Text="Name:" FontWeight="Medium" />
                    <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding SelectedAsset.Name}" />
                    
                    <TextBlock Grid.Row="0" Grid.Column="2" Text="Type:" FontWeight="Medium" />
                    <TextBlock Grid.Row="0" Grid.Column="3" Text="{Binding SelectedAsset.Type}" />
                    
                    <TextBlock Grid.Row="1" Grid.Column="0" Text="Location:" FontWeight="Medium" />
                    <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding SelectedAsset.Location}" />
                    
                    <TextBlock Grid.Row="1" Grid.Column="2" Text="Manufacturer:" FontWeight="Medium" />
                    <TextBlock Grid.Row="1" Grid.Column="3" Text="{Binding SelectedAsset.Manufacturer}" />
                    
                    <TextBlock Grid.Row="2" Grid.Column="0" Text="Model:" FontWeight="Medium" />
                    <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding SelectedAsset.ModelNumber}" />
                    
                    <TextBlock Grid.Row="2" Grid.Column="2" Text="Installed:" FontWeight="Medium" />
                    <TextBlock Grid.Row="2" Grid.Column="3" 
                             Text="{Binding SelectedAsset.InstallationDate, StringFormat='{}{0:MMM dd, yyyy}'}" />
                </Grid>

                <TextBlock Text="{Binding SelectedAsset.Description}" 
                          Opacity="0.7" 
                          TextWrapping="Wrap"
                          Margin="0,5,0,0" />
            </StackPanel>
        </Border>

    </Grid>

</UserControl>
