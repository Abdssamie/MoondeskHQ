<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:pages="clr-namespace:AquaPP.ViewModels.Pages"
             xmlns:i="https://github.com/projektanker/icons.avalonia"
             xmlns:suki="https://github.com/kikipoulet/SukiUI"
             xmlns:converters="clr-namespace:AquaPP.Converters"
             mc:Ignorable="d" d:DesignWidth="1200" d:DesignHeight="800"
             x:Class="AquaPP.Views.Pages.MonitoringDashboardView"
             x:DataType="pages:MonitoringDashboardViewModel">
    
    <UserControl.Resources>
        <converters:AssetStatusColorConverter x:Key="StatusColorConverter" />
        <converters:AssetStatusIconConverter x:Key="StatusIconConverter" />
    </UserControl.Resources>
    
    <Design.DataContext>
        <pages:MonitoringDashboardViewModel />
    </Design.DataContext>

    <ScrollViewer>
        <StackPanel Margin="20" Spacing="20">
            <!-- Header -->
            <suki:GlassCard>
                <Grid ColumnDefinitions="*,Auto" Height="60">
                    <StackPanel Grid.Column="0" VerticalAlignment="Center" Spacing="4">
                        <TextBlock Text="Monitoring Dashboard" 
                                   FontSize="24" 
                                   FontWeight="Bold"
                                   Foreground="{DynamicResource SukiText}" />
                        <TextBlock Text="Real-time asset and sensor monitoring" 
                                   FontSize="13"
                                   Foreground="{DynamicResource SukiLowText}" />
                    </StackPanel>
                    
                    <StackPanel Grid.Column="1" 
                                Orientation="Horizontal" 
                                Spacing="12"
                                VerticalAlignment="Center">
                        <Button Classes="Flat" Command="{Binding RefreshCommand}">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <i:Icon Value="fa-solid fa-arrows-rotate" FontSize="14" />
                                <TextBlock Text="Refresh" />
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </Grid>
            </suki:GlassCard>

            <!-- KPI Cards Section -->
            <Grid ColumnDefinitions="*,*,*,*" ColumnSpacing="16">
                <!-- Total Assets Card -->
                <suki:GlassCard Grid.Column="0">
                    <StackPanel Spacing="12">
                        <StackPanel Orientation="Horizontal" Spacing="12">
                            <Border Background="{DynamicResource SukiPrimaryColor}"
                                    CornerRadius="8"
                                    Width="40"
                                    Height="40"
                                    VerticalAlignment="Center">
                                <i:Icon Value="fa-solid fa-industry" 
                                        FontSize="20"
                                        Foreground="White"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center" />
                            </Border>
                            <StackPanel Spacing="4">
                                <TextBlock Text="Total Assets" 
                                           FontSize="12"
                                           Foreground="{DynamicResource SukiLowText}" />
                                <TextBlock Text="{Binding TotalAssets}" 
                                           FontSize="24"
                                           FontWeight="Bold" />
                            </StackPanel>
                        </StackPanel>
                        <TextBlock Text="Connected equipment" 
                                   FontSize="11"
                                   Foreground="{DynamicResource SukiLowText}" />
                    </StackPanel>
                </suki:GlassCard>

                <!-- Online Sensors Card -->
                <suki:GlassCard Grid.Column="1">
                    <StackPanel Spacing="12">
                        <StackPanel Orientation="Horizontal" Spacing="12">
                            <Border Background="#4CAF50"
                                    CornerRadius="8"
                                    Width="40"
                                    Height="40"
                                    VerticalAlignment="Center">
                                <i:Icon Value="fa-solid fa-list" 
                                        FontSize="20"
                                        Foreground="White"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center" />
                            </Border>
                            <StackPanel Spacing="4">
                                <TextBlock Text="Online Sensors" 
                                           FontSize="12"
                                           Foreground="{DynamicResource SukiLowText}" />
                                <TextBlock Text="{Binding OnlineSensors}" 
                                           FontSize="24"
                                           FontWeight="Bold" />
                            </StackPanel>
                        </StackPanel>
                        <TextBlock Text="Active monitoring" 
                                   FontSize="11"
                                   Foreground="#4CAF50" />
                    </StackPanel>
                </suki:GlassCard>

                <!-- Active Alerts Card -->
                <suki:GlassCard Grid.Column="2">
                    <StackPanel Spacing="12">
                        <StackPanel Orientation="Horizontal" Spacing="12">
                            <Border Background="#FF4757"
                                    CornerRadius="8"
                                    Width="40"
                                    Height="40"
                                    VerticalAlignment="Center">
                                <i:Icon Value="fa-solid fa-bell" 
                                        FontSize="20"
                                        Foreground="White"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center" />
                            </Border>
                            <StackPanel Spacing="4">
                                <TextBlock Text="Active Alerts" 
                                           FontSize="12"
                                           Foreground="{DynamicResource SukiLowText}" />
                                <TextBlock Text="{Binding ActiveAlerts}" 
                                           FontSize="24"
                                           FontWeight="Bold" />
                            </StackPanel>
                        </StackPanel>
                        <TextBlock Text="Requires attention" 
                                   FontSize="11"
                                   Foreground="#FF4757" />
                    </StackPanel>
                </suki:GlassCard>

                <!-- System Uptime Card -->
                <suki:GlassCard Grid.Column="3">
                    <StackPanel Spacing="12">
                        <StackPanel Orientation="Horizontal" Spacing="12">
                            <Border Background="#2196F3"
                                    CornerRadius="8"
                                    Width="40"
                                    Height="40"
                                    VerticalAlignment="Center">
                                <i:Icon Value="fa-solid fa-clock" 
                                        FontSize="20"
                                        Foreground="White"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center" />
                            </Border>
                            <StackPanel Spacing="4">
                                <TextBlock Text="System Uptime" 
                                           FontSize="12"
                                           Foreground="{DynamicResource SukiLowText}" />
                                <TextBlock Text="{Binding SystemUptime}" 
                                           FontSize="24"
                                           FontWeight="Bold" />
                            </StackPanel>
                        </StackPanel>
                        <TextBlock Text="Running smoothly" 
                                   FontSize="11"
                                   Foreground="#2196F3" />
                    </StackPanel>
                </suki:GlassCard>
            </Grid>

            <!-- Asset Status Cards Section -->
            <suki:GlassCard>
                <StackPanel Spacing="16">
                    <StackPanel Orientation="Horizontal" Spacing="12">
                        <i:Icon Value="fa-solid fa-chart-simple" 
                                FontSize="18"
                                Foreground="{DynamicResource SukiPrimaryColor}"
                                VerticalAlignment="Center" />
                        <TextBlock Text="Asset Status Overview" 
                                   FontSize="16" 
                                   FontWeight="SemiBold"
                                   VerticalAlignment="Center" />
                    </StackPanel>
                    
                    <Separator />
                    
                    <!-- Loading Indicator -->
                    <StackPanel IsVisible="{Binding IsLoading}" 
                                HorizontalAlignment="Center" 
                                VerticalAlignment="Center"
                                Spacing="12"
                                Margin="0,40">
                        <i:Icon Value="fa-solid fa-spinner" 
                                FontSize="48"
                                Foreground="{DynamicResource SukiPrimaryColor}"
                                HorizontalAlignment="Center" />
                        <TextBlock Text="Loading assets..." 
                                   HorizontalAlignment="Center"
                                   Foreground="{DynamicResource SukiLowText}" />
                    </StackPanel>
                    
                    <!-- Asset Cards Grid -->
                    <ItemsControl ItemsSource="{Binding Assets}" 
                                  IsVisible="{Binding !IsLoading}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel Orientation="Horizontal" />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <suki:GlassCard Width="280" 
                                                Height="220" 
                                                Margin="0,0,16,16"
                                                Cursor="Hand">
                                    <suki:GlassCard.Styles>
                                        <Style Selector="suki|GlassCard:pointerover">
                                            <Setter Property="Opacity" Value="0.9" />
                                        </Style>
                                    </suki:GlassCard.Styles>
                                    
                                    <Button Classes="Flat" 
                                            Command="{Binding $parent[ItemsControl].((pages:MonitoringDashboardViewModel)DataContext).NavigateToAssetCommand}"
                                            CommandParameter="{Binding AssetId}"
                                            Padding="0"
                                            HorizontalAlignment="Stretch"
                                            VerticalAlignment="Stretch"
                                            HorizontalContentAlignment="Stretch"
                                            VerticalContentAlignment="Stretch">
                                        <StackPanel Spacing="12">
                                            <!-- Asset Header -->
                                            <Grid ColumnDefinitions="*,Auto">
                                                <StackPanel Grid.Column="0" Spacing="4">
                                                    <TextBlock Text="{Binding Name}" 
                                                               FontSize="16"
                                                               FontWeight="SemiBold"
                                                               TextTrimming="CharacterEllipsis" />
                                                    <TextBlock Text="{Binding Type}" 
                                                               FontSize="11"
                                                               Foreground="{DynamicResource SukiLowText}" />
                                                </StackPanel>
                                                
                                                <!-- Status Indicator -->
                                                <Border Grid.Column="1"
                                                        Background="{Binding Status, Converter={StaticResource StatusColorConverter}}"
                                                        CornerRadius="12"
                                                        Padding="8,4"
                                                        VerticalAlignment="Top">
                                                    <StackPanel Orientation="Horizontal" Spacing="6">
                                                        <i:Icon Value="{Binding Status, Converter={StaticResource StatusIconConverter}}" 
                                                                FontSize="12"
                                                                Foreground="White" />
                                                        <TextBlock Text="{Binding Status}" 
                                                                   FontSize="11"
                                                                   Foreground="White"
                                                                   FontWeight="SemiBold" />
                                                    </StackPanel>
                                                </Border>
                                            </Grid>
                                            
                                            <Separator />
                                            
                                            <!-- Location and Sensor Count -->
                                            <Grid ColumnDefinitions="*,*" ColumnSpacing="8">
                                                <StackPanel Grid.Column="0" Spacing="4">
                                                    <TextBlock Text="Location" 
                                                               FontSize="10"
                                                               Foreground="{DynamicResource SukiLowText}" />
                                                    <TextBlock Text="{Binding Location}" 
                                                               FontSize="12"
                                                               FontWeight="SemiBold"
                                                               TextTrimming="CharacterEllipsis" />
                                                </StackPanel>
                                                <StackPanel Grid.Column="1" Spacing="4">
                                                    <TextBlock Text="Sensors" 
                                                               FontSize="10"
                                                               Foreground="{DynamicResource SukiLowText}" />
                                                    <StackPanel Orientation="Horizontal" Spacing="6">
                                                        <i:Icon Value="fa-solid fa-list" 
                                                                FontSize="12"
                                                                Foreground="{DynamicResource SukiPrimaryColor}" />
                                                        <TextBlock Text="{Binding SensorCount}" 
                                                                   FontSize="12"
                                                                   FontWeight="SemiBold" />
                                                    </StackPanel>
                                                </StackPanel>
                                            </Grid>
                                            
                                            <!-- Key Metrics -->
                                            <StackPanel Spacing="8">
                                                <TextBlock Text="Key Metrics" 
                                                           FontSize="10"
                                                           Foreground="{DynamicResource SukiLowText}" />
                                                <ItemsControl ItemsSource="{Binding KeyMetrics}">
                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>
                                                            <Grid ColumnDefinitions="*,Auto" Margin="0,2">
                                                                <TextBlock Grid.Column="0" 
                                                                           Text="{Binding Key}" 
                                                                           FontSize="11"
                                                                           TextTrimming="CharacterEllipsis" />
                                                                <TextBlock Grid.Column="1" 
                                                                           Text="{Binding Value, StringFormat='{}{0:F2}'}" 
                                                                           FontSize="11"
                                                                           FontWeight="SemiBold" />
                                                            </Grid>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>
                                            </StackPanel>
                                            
                                            <!-- Alerts Badge (only shown if alerts > 0) -->
                                            <StackPanel Orientation="Horizontal" Spacing="6">
                                                <i:Icon Value="fa-solid fa-circle-info" 
                                                        FontSize="10"
                                                        Foreground="{DynamicResource SukiLowText}" />
                                                <TextBlock Text="{Binding ActiveAlerts, StringFormat='No active alerts'}" 
                                                           FontSize="10"
                                                           Foreground="{DynamicResource SukiLowText}" />
                                            </StackPanel>
                                        </StackPanel>
                                    </Button>
                                </suki:GlassCard>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                    
                    <!-- Empty State (shown when no assets and not loading) -->
                    <!-- Note: This will be visible when Assets.Count is 0 -->
                    <StackPanel HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                Spacing="12"
                                Margin="0,40">
                        <i:Icon Value="fa-solid fa-inbox" 
                                FontSize="48"
                                Foreground="{DynamicResource SukiLowText}"
                                HorizontalAlignment="Center" />
                        <TextBlock Text="No assets found" 
                                   FontSize="16"
                                   FontWeight="SemiBold"
                                   HorizontalAlignment="Center"
                                   Foreground="{DynamicResource SukiLowText}" />
                        <TextBlock Text="Add assets to start monitoring" 
                                   FontSize="13"
                                   HorizontalAlignment="Center"
                                   Foreground="{DynamicResource SukiLowText}" />
                    </StackPanel>
                </StackPanel>
            </suki:GlassCard>
        </StackPanel>
    </ScrollViewer>
    
</UserControl>
