syntax = "proto3";

package aquapp.monitoring;

import "data.proto";
import "google/protobuf/empty.proto";
import "google/protobuf/timestamp.proto";

// --- SERVICES ---

service RealTimeMonitoringService {
  rpc StreamReadings(google.protobuf.Empty) returns (stream aquapp.data.SensorReading);
  rpc StreamMetrics(google.protobuf.Empty) returns (stream aquapp.data.CalculatedMetric);
  rpc StreamAlerts(google.protobuf.Empty) returns (stream aquapp.data.Alert);
}

service AssetManagementService {
  rpc GetAsset(AssetIdRequest) returns (aquapp.data.Asset);
  rpc GetAllAssets(google.protobuf.Empty) returns (stream aquapp.data.Asset);
  rpc UpdateAsset(aquapp.data.Asset) returns (aquapp.data.Asset);
  rpc GetAssetHierarchy(AssetIdRequest) returns (AssetHierarchyResponse);
  rpc GetAssetConfiguration(AssetIdRequest) returns (aquapp.data.Configuration);
  rpc UpdateAssetConfiguration(aquapp.data.Configuration) returns (aquapp.data.Configuration);
}

service HistoricalDataService {
  rpc GetHistoricalReadings(HistoricalQuery) returns (stream aquapp.data.SensorReading);
  rpc GetHistoricalMetrics(HistoricalQuery) returns (stream aquapp.data.CalculatedMetric);
}

service AlertService {
  rpc GetActiveAlerts(google.protobuf.Empty) returns (stream aquapp.data.Alert);
  rpc GetHistoricalAlerts(HistoricalQuery) returns (stream aquapp.data.Alert);
  rpc AcknowledgeAlert(AcknowledgeAlertRequest) returns (aquapp.data.Alert);
}

service CommandService {
  rpc SendCommand(aquapp.data.AssetCommand) returns (aquapp.data.AssetCommand);
  rpc GetCommandStatus(CommandIdRequest) returns (aquapp.data.AssetCommand);
  rpc StreamCommandUpdates(CommandIdRequest) returns (stream aquapp.data.AssetCommand);
}

// --- SERVICE HELPER MESSAGES ---

message AssetIdRequest {
  int32 asset_id = 1;
}

message CommandIdRequest {
  int64 command_id = 1;
}

message HistoricalQuery {
  int32 source_id = 1; // Asset ID or Sensor ID
  string source_type = 2; // "ASSET", "SENSOR", or "METRIC"
  google.protobuf.Timestamp start_time = 3;
  google.protobuf.Timestamp end_time = 4;
}

message AcknowledgeAlertRequest {
  int32 alert_id = 1;
  string acknowledged_by = 2;
  string notes = 3;
}

message AssetHierarchyResponse {
  repeated aquapp.data.Asset assets = 1;
}